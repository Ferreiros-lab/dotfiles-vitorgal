# oh-my-zsh
ZSH=${HOME}/.oh-my-zsh # config dir
DISABLE_UPDATE_PROMPT=true # auto-update without prompting
ZSH_THEME="oneend" # set name of the theme to load (in ~/.oh-my-zsh/themes/)
plugins=(brew brew-cask git git-extras history-substring-search web-search zsh-syntax-highlighting) # plugins to load
source ${ZSH}/oh-my-zsh.sh # load it

# other settings
unsetopt correct_all # disable autocorrect
export LSCOLORS=hxfxcxdxbxegedabagacad
export PATH="/usr/local/bin:/usr/local/sbin:$PATH:/usr/local/opt/ruby/bin:/usr/local/share/npm/bin"
export GEM_HOME="$(brew --prefix)"
export EDITOR="vim"
export HOMEBREW_CASK_OPTS="--appdir=/Applications"
export LANG=en_GB.UTF-8
export LC_ALL=en_GB.UTF-8
setopt interactivecomments
bindkey '√' edit-command-line # press ⌥+v to edit command in text editor

# source z and crafts
source "$(brew --prefix)/etc/profile.d/z.sh"
source "$(brew --prefix)/etc/profile.d/crafts"

############################################

# aliases and functions
# vm-specific
vmmachine="${HOME}/Documents/Virtual Machines.localized/Mac OS X 10.9.vmwarevm/Mac OS X 10.9.vmx"
vmusername="vm"
vmpassword="m"
alias vmstart='vmrun start "${vmmachine}"'
alias vmstop='osascript -e "tell application \"VMware Fusion\" to quit"'
alias vmdev='vmrun revertToSnapshot "${vmmachine}" brew+cask && vmrun start "${vmmachine}"'
alias vmdevupdate='vmrun revertToSnapshot "${vmmachine}" brew+cask && vmrun start "${vmmachine}" && vmrun deleteSnapshot "${vmmachine}" brew+cask && sleep 20 && vmrun -gu "${vmusername}" -gp "${vmpassword}" runScriptInGuest "${vmmachine}" "/bin/bash" "echo \"${vmpassword}\" | sudo -S softwareupdate -ia" && vmrun -gu "${vmusername}" -gp "${vmpassword}" runScriptInGuest "${vmmachine}" "/bin/bash" "/usr/local/bin/brew update && /usr/local/bin/brew upgrade" && vmrun suspend "${vmmachine}" && vmrun snapshot "${vmmachine}" brew+cask && killall "VMware Fusion"'
alias vmdesign='vmrun revertToSnapshot "${vmmachine}" design && vmrun start "${vmmachine}"'

# always use alternate progress downloader in axel
axel='axel -a'

# update homebrew
alias brewu='brew update && brew upgrade && brew doctor && brew cleanup --force -s && rm -rf "$(brew --cache)"'

# update everything
alias updateall='softwareupdate -ia && brew update && brew upgrade && gem update && npm --silent --global update && pip freeze --local | grep -v "^\-e" | cut -d = -f 1  | xargs pip install -U'

# Fix duplicates in “open with”
alias openwithfix='/System/Library/Frameworks/CoreServices.framework/Frameworks/LaunchServices.framework/Support/lsregister -kill -r -domain local -domain system -domain user && killall Finder'

# cd to default Code directory
alias cdc='cd ~/Dropbox/work/personal/code'

# cd to default Processing directory
alias cdp='cd ~/Dropbox/work/personal/processing'

# delete .DS_Store files
alias dsd='find . -iname ".DS_Store" -delete'

# delete empty files and dirs
alias zerod='find . -empty -delete 2>/dev/null'

# search in history
alias h='history | grep -i'

# quicklook
alias ql='qlmanage -p &>/dev/null'

# quickly stream from video sites
qs() {
  mpv "$(youtube-dl -g ${1})"
}

# ISS live stream with audio
iss() {
  livestreamer "http://www.ustream.tv/channel/iss-hdev-payload" best &
  while true; do
    livestreamer "http://www.youtube.com/watch?v=UwAzXBCCQrQ" best
    sleep 3
  done
}

# fix file and directory permissions
permissionsfix() { find "$@" -type d -exec chmod 755 {} \; && find "$@" -type f -exec chmod 644 {} \; }

# get shasum fast
shacurl() {
  sha256=$(noglob curl -#L "$1" | shasum -a 256 | sed 's/ .*//' | tr -d '\n')
  echo "${sha256}"
  echo -n "${sha256}" | pbcopy
}

# aliases for git
alias g='git'
alias ga='git add --all'
alias gap='git add --patch'
alias gb='git branch'
alias gbd='currentBranch="$(git rev-parse --abbrev-ref HEAD)" && git checkout master && git branch -D "${currentBranch}" && unset currentBranch'
alias gbD='git branch -D'
alias gc='git commit -v'
alias gca='git commit --verbose --all --message'
alias gco='git checkout'
alias gcb='git checkout -b'
alias gcm='git checkout master'
alias gcp='git cherry-pick'
alias gd='git diff'
alias gl='git log --graph --pretty=format":%C(yellow)%h%Cblue%d%Creset %s %C(white) %an, %ar%Creset"'
alias gme='git merge --no-ff'
alias gmf='git merge --ff-only'
alias gp='git push'
alias gpoat='git push origin --all && git push origin --tags'
alias gpom='git push origin master'
alias gpo='git push origin'
alias gpum='git push upstream master'
alias gplom='git pull origin master'
alias gplum='git pull upstream master'
alias gpl='git pull'
alias gre='git remote'
alias gr='git reset'
alias grh='git reset --hard'
alias grhh='git reset HEAD --hard'
alias grb='git rebase -i'
alias grbh='git rebase -i HEAD~'
alias grbl='git reset --soft @~ && git commit --amend -C HEAD' # 'git rebase last' to fixup last two commits
alias grbn='git commit --all --allow-empty-message --message "" && git reset --soft @~ && git commit --amend -C HEAD' # 'git rebase now' to commit the current change and then fixup to previous commit
alias gs='git stash'
alias gsl='git stash list'
alias gsa='git stash apply'
alias gsb='git stash branch'
alias gst='git status'
alias gss='git status -s'
alias gclean='git clean -ndx'
alias gcleanf='git clean -dxf'
